const originalClock = [
  ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#'],
  ['#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#'],
  ['#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#'],
  ['#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#'],
  ['#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#'],
  ['#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#'],
  ['-', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '-'],
  ['-', '-', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '-', '-'],
  ['-', '-', '-', '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#', '-', '-', '-'],
  ['-', '-', '-', '-', '#', '.', '.', '.', '.', '.', '.', '.', '#', '-', '-', '-', '-'],
  ['-', '-', '-', '-', '-', '#', '#', '.', '.', '.', '#', '#', '-', '-', '-', '-', '-'],
  ['-', '-', '-', '-', '-', '-', '-', '#', '.', '#', '-', '-', '-', '-', '-', '-', '-'],
  ['-', '-', '-', '-', '-', '-', '-', '#', ' ', '#', '-', '-', '-', '-', '-', '-', '-'],
  ['-', '-', '-', '-', '-', '-', '-', '#', ' ', '#', '-', '-', '-', '-', '-', '-', '-'],
  ['-', '-', '-', '-', '-', '#', '#', ' ', ' ', ' ', '#', '#', '-', '-', '-', '-', '-'],
  ['-', '-', '-', '-', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '-', '-', '-', '-'],
  ['-', '-', '-', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '-', '-', '-'],
  ['-', '-', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '-', '-'],
  ['-', '#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#', '-'],
  ['#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#'],
  ['#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#'],
  ['#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#'],
  ['#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#'],
  ['#', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '#'],
  ['#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#', '#']
]

let currentClock = JSON.parse(JSON.stringify(originalClock));
let counter = 0;

function updateClock() {
  for (let i = 22; i > 0; i--) {
    for (let j = 0; j < 16; j++) {
      if (currentClock[i][j] === '.') {
        if (currentClock[i + 1][j] === ' ') {
          currentClock[i][j] = ' ';
          currentClock[i + 1][j] = 'U';
        } else {
          if (currentClock[i + 1][j - 1] === ' ') {
            currentClock[i][j] = ' ';
            currentClock[i + 1][j - 1] = 'U';
          } else if (currentClock[i + 1][j + 1] === ' ') {
            currentClock[i][j] = ' ';
            currentClock[i + 1][j + 1] = 'U';
          } else if (currentClock[i + 1][j - 2] === ' ') {
            currentClock[i][j] = ' ';
            currentClock[i + 1][j - 2] = 'U';
          } else if (currentClock[i + 1][j + 2] === ' ') {
            currentClock[i][j] = ' ';
            currentClock[i + 1][j + 2] = 'U';
          }
        }
      }
    }
  }
}

function cleanClock() {
  for (let i = 0; i < 24; i++) {
    for (let j = 0; j < 16; j++) {
      if (currentClock[i][j] === 'U') {
        currentClock[i][j] = '.';
      }
    }
  }
}

function getClockString(): string {
  let finalString = '';
  currentClock.forEach((row: string[]) => {
    let rowString = '';
    row.forEach(cell => {
      if (cell === '-') {
        rowString += ' ';
      } else {
        rowString += cell;
      }
    })
    finalString += rowString + '\n';
  });
  return finalString;
}

export function getSandglassMatrix(): string {
  updateClock();
  cleanClock();
  
  counter++;
  if (counter == 120) {
    counter = 0;
    currentClock = JSON.parse(JSON.stringify(originalClock));
  }
  return getClockString();
}